name: Deploy to Production

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to server
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd /path/to/your/project
            git pull origin main
            ./deploy.sh
            curl -X POST \
              -H "X-API-Key: ${{ secrets.PORTAINER_API_KEY }}" \
              -H "Content-Type: application/json" \
              -d '{"Name": "liana-backend", "SwarmID": "your-swarm-id", "StackFileContent": "$(cat docker-compose.prod.yml)"}' \
              http://your-portainer-url/api/stacks/your-stack-id/update 